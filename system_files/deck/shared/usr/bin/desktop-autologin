#!/usr/bin/env bash

source /etc/default/bazzite
source /etc/default/desktop-wayland

USER=$(id -nu 1000)

# SteamOS SDDM config
SDDM_CONF='/etc/sddm.conf.d/steamos.conf'

# Configure SDDM autologin
if [[ ${BASE_IMAGE_NAME} =~ "kinoite" ]]; then
  if ${DESKTOP_WAYLAND}; then
    sed -i 's/.*Session=.*/Session=plasma.desktop/g' ${SDDM_CONF}
  else
    sed -i 's/.*Session=.*/Session=plasmax11.desktop/g' ${SDDM_CONF}
  fi
elif [[ ${BASE_IMAGE_NAME} =~ "silverblue" ]]; then
  if ${DESKTOP_WAYLAND}; then
    sed -i 's/.*Session=.*/Session=gnome-wayland.desktop/g' ${SDDM_CONF}
  else
    sed -i 's/.*Session=.*/Session=gnome-xorg.desktop/g' ${SDDM_CONF}
  fi
fi
sed -i 's/.*User=.*/User='${USER}'/g' ${SDDM_CONF}
