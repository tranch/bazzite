From b453e6457b4cd35c867618b4f68346373b282f29 Mon Sep 17 00:00:00 2001
From: Matthew Schwartz <njtransit215@gmail.com>
Date: Sun, 26 May 2024 19:42:34 -0700
Subject: [PATCH 1/2] Revert "set timeout_ns to max"

This reverts commit a9199c2097ffc9d7f96ccf1eb8a04004b1f643de.
---
 src/drm.cpp | 8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

diff --git a/src/drm.cpp b/src/drm.cpp
index 0b73ebc..e1464a7 100644
--- a/src/drm.cpp
+++ b/src/drm.cpp
@@ -1172,7 +1172,7 @@ bool init_drm(struct drm_t *drm, int width, int height, int refresh)
 		return false;
 	if ( liftoff_device_register_all_planes( drm->lo_device ) < 0 )
 		return false;
-	
+
 	drm_log.infof("Connectors:");
 	for ( auto &iter : drm->connectors )
 	{
@@ -2481,11 +2481,7 @@ drm_prepare_liftoff( struct drm_t *drm, const struct FrameInfo_t *frameInfo, boo
 		}
 	}
 
-	struct liftoff_output_apply_options lo_options = {
-		.timeout_ns = std::numeric_limits<int64_t>::max()
-	};
-
-	int ret = liftoff_output_apply( drm->lo_output, drm->req, drm->flags, &lo_options);
+	int ret = liftoff_output_apply( drm->lo_output, drm->req, drm->flags );
 
 	// The NVIDIA 555 series drivers started advertising DRM_CAP_SYNCOBJ, but do
 	// not support IN_FENCE_FD. However, there is no way to hide the IN_FENCE_FD
-- 
2.45.1

From 1b52c18255d7b832d632f6d5975c48dd56c21d11 Mon Sep 17 00:00:00 2001
From: Matthew Schwartz <njtransit215@gmail.com>
Date: Sun, 26 May 2024 19:43:43 -0700
Subject: [PATCH 2/2] hotfix: revert until libliftoff/gamescope issues are
 resolved

---
 src/drm.cpp            | 2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/src/drm.cpp b/src/drm.cpp
index e1464a7..0d2bd45 100644
--- a/src/drm.cpp
+++ b/src/drm.cpp
@@ -2499,7 +2499,7 @@ drm_prepare_liftoff( struct drm_t *drm, const struct FrameInfo_t *frameInfo, boo
 			liftoff_layer_set_property( drm->lo_layers[ i ], "IN_FENCE_FD", -1 );
 		}
 
-		ret = liftoff_output_apply( drm->lo_output, drm->req, drm->flags, &lo_options );
+		ret = liftoff_output_apply( drm->lo_output, drm->req, drm->flags );
 
 		if ( ret == 0 )
 		{
-- 
2.45.1

